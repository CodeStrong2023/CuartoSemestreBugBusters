"use strict";function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t,r=arguments[n];for(t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e}).apply(this,arguments)}!function(e){var a="trakdesk_cid";function s(e){return"trakdesk_cid_"+e}function l(e,n){var n=t(n?s(e):a);return n?(n=JSON.parse(n)).tenantId!==e?(console.debug("provided tenant id in cookie '"+n.tenantId+"' does not equal with event tenant id '"+e+"'"),null):n:null}function r(e,n,t,r){var i,o=r?s(e):a,e=JSON.stringify({tenantId:e,cid:n}),n=t,t=r;n?i=new Date(n):(i=new Date).setMonth(i.getMonth()+1),n=function(e){if(e){if(function(e){try{var n=new URL("https://"+e);return e===n.hostname}catch(e){}}(e)&&function(e,n){if(!n.endsWith(e))return;e=e.split("."),n=n.split(".");if(e.length>n.length)return;var t=e[0],n=n[n.length-e.length];return t===n||""===t}(e,location.hostname))return e;console.debug("Specified domain '"+e+"' is not parent of current domain '"+location.hostname+"'. '"+location.hostname+"' will be used instead.")}return function(e){if(e.startsWith("www."))return e.slice(4);return e}(location.hostname)}(t),document.cookie=o+"="+e+";expires="+i.toUTCString()+";domain="+n+";path=/"}function t(e){e=("; "+document.cookie).split("; "+e+"=");return 2===e.length?e.pop().split(";").shift():null}n.getStringValue=function(e){return e?this.isString(e)?e:"object"!=typeof e?(console.debug("type is neither a string nor an object: "+typeof e),null):e.cookieParam&&this.isString(e.cookieParam)?t(e.cookieParam):e.queryParam&&this.isString(e.queryParam)?n.getFromQuery(e.queryParam):null:null},n.isString=function(e){return"string"==typeof e||e instanceof String},n.getFromQuery=function(e){e=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return e&&decodeURIComponent(e[1].replace(/\+/g," "))},(e=n).config={host:"trackdesk.com",service:"tracking",cidCookieKey:"trakdesk_cid",directClickApi:"/direct-click/v1",conversionApi:"/conversion/v1",externalCidApi:"/external-cid/v1"};var u=e;function n(){}(e=i.prototype).getUrl=function(){return u.config.directClickApi},e.prepareEventData=function(e,n){var t,r,i=u.getFromQuery("sourceId");return i?(t=u.getFromQuery("linkId"))?(r=u.getFromQuery("tenantId"))?n!==r?(console.debug("provided tenant id in url '"+r+"' not equals with event '"+n+"'"),null):{_meta:null==e?void 0:e._meta,data:{linkId:t,sourceId:i,referrer:window.document.referrer,customParams:{affS1:u.getFromQuery("affS1"),affS2:u.getFromQuery("affS2"),affS3:u.getFromQuery("affS3"),affS4:u.getFromQuery("affS4"),affS5:u.getFromQuery("affS5")}}}:(console.debug("not provided tenant id in url params"),null):(console.debug("not provided link id in url params"),null):(console.debug("not provided source id in url params"),null)},e.processResponse=function(e,n,t,r){this.setCidCookie(t,n,null==r?void 0:r.cidDomain)},e.setCidCookie=function(e,n,t){r(e,n.cid,n.expiredAt,t)};e=i;function i(){}(o=c.prototype).getUrl=function(){return u.config.conversionApi},o.prepareEventData=function(e,n){var t,r,i,o,a,n=function(e,n,t,r){var i=!!e.externalCid,o=!(!e.couponCodes||!e.couponCodes.length),a=null;if(!t&&(i||o))return console.error("missing revenue origin id"),null;if(!e.externalCid&&!(a=l(n,r))&&!o)return console.debug("cid cookie not found"),null;t={};i&&(t.externalCid=e.externalCid);a&&(t.cid=a.cid);o&&(t.couponCodes=e.couponCodes);return t}(e,n,e.revenueOriginId,null==e||null==(n=e._meta)?void 0:n.cidDomain);return n&&(i=(t=e).amount?u.getStringValue(t.amount.value):null,o=t.status?u.getStringValue(t.status):null,o=(a=u.getStringValue(t.conversionType))?(r=u.getStringValue(t.currencyCode),{conversionTypeCode:a,status:o,amount:i?{value:i}:null,currency:r?{code:r}:null,customParams:{advS1:u.getStringValue(null==(a=t.customParams)?void 0:a.advS1),advS2:u.getStringValue(null==(o=t.customParams)?void 0:o.advS2),advS3:u.getStringValue(null==(i=t.customParams)?void 0:i.advS3),advS4:u.getStringValue(null==(r=t.customParams)?void 0:r.advS4),advS5:u.getStringValue(null==(a=t.customParams)?void 0:a.advS5)},customerId:u.getStringValue(t.customerId),externalId:u.getStringValue(t.externalId),revenueOriginId:u.getStringValue(t.revenueOriginId)}):(console.error("missing conversion type code"),null))?{_meta:null==e?void 0:e._meta,data:_extends({},n,o)}:null},o.processResponse=function(e,n,t){};var o=c;function c(){}(d=g.prototype).getUrl=function(){return u.config.externalCidApi},d.prepareEventData=function(e,n){var t,n=l(n,null==(n=e._meta)?void 0:n.cidDomain);return n?(t=u.getStringValue(e.externalCid))?(e=u.getStringValue(e.revenueOriginId))?{data:{externalCid:t,revenueOriginId:e,cid:n.cid}}:(console.error("missing revenue origin id"),null):(console.error("missing external cid"),null):(console.debug("cid cookie not found"),null)},d.processResponse=function(e,n,t){};var d=g;function g(){}(p={}).click="click",p.conversion="conversion",p.externalCid="externalCid";var v,f,p,m=p;function h(e,n,t){this.clickHandler=void 0,this.conversionHandler=void 0,this.couponConversionHandler=void 0,this.externalCidHandler=void 0,this.clickHandler=e,this.conversionHandler=n,this.externalCidHandler=t}(p=h.prototype).processEvent=function(e){var n,t,r,e=this.createTrackingEvent(e);e&&((n=this.findTrackingHandler(e.eventType))?(r=n.getUrl())&&(t=n.prepareEventData(e.eventData,e.tenantId))&&(r=this.getRequestUrl(e.tenantId,r),this.sendXhrRequest(new XMLHttpRequest,n,e.tenantId,r,t,e.callback)):console.error("invalid tracking event type: "+e.eventType))},p.getRequestUrl=function(e,n){return"https://"+e+"."+u.config.host+"/"+u.config.service+n},p.sendXhrRequest=function(n,t,r,e,i,o){n.onreadystatechange=function(){var e;n.readyState===XMLHttpRequest.DONE&&200<=n.status&&n.status<300&&(e=n.responseText?JSON.parse(n.responseText):{},t.processResponse(n,e,r,i._meta),o)&&o(e)},n.open("POST",e,!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(JSON.stringify(i.data))},p.handleData=function(e){if(e&&Array.isArray(e))for(;e.length;){var n=e.shift();n.length&&this.processEvent(n)}},p.processEventFromArguments=function(){arguments&&arguments.length&&this.processEvent(arguments)},p.findTrackingHandler=function(e){switch(e){case"click":return this.clickHandler;case"conversion":return this.conversionHandler;case"externalCid":return this.externalCidHandler;default:return null}},p.createTrackingEvent=function(e){if(e.length<2||4<e.length)console.error("invalid data length");else if(u.isString(e[0])){var n=e[0];if(n){var t=m[e[1]];if(t)return{tenantId:n,eventType:t,eventData:null!=(n=e[2])?n:{},callback:e[3]};console.error("invalid tracking event type: "+t)}else console.error("missing tenant id")}else console.error("tenant id is not a string")},p=new h(new e,new o,new d),e=(p=p).processEventFromArguments.bind(p),(o=window)[d="TrackdeskObject"]?(f=o[d].shift(),null!=(v=o[f])&&v.q&&p.handleData(o[f].q),o[f]=e):(o[d]=[],o[d].f=e)}();